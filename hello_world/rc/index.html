<!DOCTYPE html>
<html>
<body>
  Hello from RP2040 with WebSocket Handshake, any key you type will be sent over usb to the attached computer.

  Text sent (key/duration): <p id="display"></p>

  <input type="text" id="input" name="input"/>
  
  <script>

    class WebSocketHandler {
        constructor() {
            this.ws = new WebSocket("wss://" + location.hostname + ":443/websocket");

            this.ws.addEventListener("error", (event) => {
                console.log("WebSocket error: ", event);
            });
      
            this.ws.addEventListener("message", (event) => {
                console.log("Message from server ", event.data);
            });

            // sending keyboard events over usb
            this.keyCodeStart=null

            document.addEventListener('keyup', () => { this.onKeyUp(event); });
            document.addEventListener('keydown', () => { this.onKeyDown(event); });

            let target = document.getElementsByTagName("input")[0];
            target.focus();
            target.click();
        }
        
        onKeyDown(event) {
            if (this.keyCodeStart == null) {
                this.keyCodeStart=performance.now();
            }
        }

        onKeyUp(event) {
            if (this.keyCodeStart != null) {
                var durationms = (performance.now() - this.keyCodeStart);
                this.keyCodeStart = null;
                document.getElementById("display").innerHTML = document.getElementById("display").innerHTML + String.fromCharCode(event.keyCode) + "[" + durationms.toString() + "]";

                this.ws.send("k " + String.fromCharCode(event.keyCode) + " " + durationms.toString() + "\n");
            }
        }
    }
    let handler = new WebSocketHandler();
  </script>
</body>
</html>

